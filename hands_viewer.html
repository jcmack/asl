<!DOCTYPE html>
<html>
<head>
    <title>Intel(R) RealSense(TM) SDK Web Sample</title>

    <script type="text/javascript" src="\asl\libs\jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="\asl\libs\promise-1.0.0.min.js"></script>
    <script type="text/javascript" src="\asl\libs\realsense-3.0.js"></script>
    <script type="text/javascript" src="\asl\libs\realsenseinfo-3.0.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var sense;
            var imageSize;
            var handModule;
            var handConfiguration;

            // check platform compatibility
            RealSenseInfo(['hand'], function (info) {
                if (info.IsReady == true) {
                    $('#info').append('<b>Platform supports Intel(R) RealSense(TM) SDK feature</b>');
                    status('OK');
                    document.getElementById("Start").disabled = false;
                } else {
                    status('Platform not supported: ' + info.responseText);
                    if (info.IsPlatformSupported != true) {
                        $('#info').append('<b>Intel® RealSense™ 3D camera not found</b>');
                    } else if (info.IsBrowserSupported != true) {
                        $('#info').append('<b>Please update your browser to latest version</b>');
                    } else {
                        $('#info').append('<b>Please download and install the following update(s) before running sample: </b>');
                        for (i = 0; i < info.Updates.length; i++) {
                            $('#info').append('<a href="' + info.Updates[i].url + '">' + info.Updates[i].href + '</a><br>');
                        }
                    }
                }
            })

            $('#Start').click(function () {
                document.getElementById("Start").disabled = true;
                PXCMSenseManager_CreateInstance().then(function (result) {
                    sense = result;
                    return sense.EnableHand(onHandData);
                }).then(function (result) {
                    handModule = result;
                    status('Init started');
                    return sense.Init(onConnect, onStatus);
                }).then(function (result) {
                    return handModule.CreateActiveConfiguration();
                }).then(function (result) {
                    handConfiguration = result;
                    if (document.getElementById("alerts").checked)
                        return handConfiguration.EnableAllAlerts();
                    else
                        return handConfiguration.DisableAllAlerts();
                }).then(function (result) {
                    if (document.getElementById("gestures").checked)
                        return handConfiguration.EnableAllGestures(false);
                    else
                        return handConfiguration.DisableAllGestures();
                }).then(function (result) {
                    return handConfiguration.ApplyChanges();
                }).then(function (result) {
                    return sense.QueryCaptureManager();
                }).then(function (capture) {
                    return capture.QueryImageSize(pxcmConst.PXCMCapture.STREAM_TYPE_DEPTH);
                }).then(function (result) {
                    imageSize = result.size;
                    return sense.StreamFrames();
                }).then(function (result) {
                    status('Streaming ' + imageSize.width + 'x' + imageSize.height);
                    document.getElementById("Stop").disabled = false;
                }).catch(function (error) {
                    status('Init failed: ' + JSON.stringify(error));
                    document.getElementById("Start").disabled = false;
                });
            });

            function clear() {
                $('#alerts_status').text('');
                $('#gestures_status').text('');
                document.getElementById("Start").disabled = false;
                var canvas = document.getElementById('myCanvas');
                var context = canvas.getContext('2d');
                context.clearRect(0, 0, canvas.width, canvas.height);
            }

            $('#Stop').click(function () {
                document.getElementById("Stop").disabled = true;
                sense.Close().then(function (result) {
                    status('Stopped');
                    clear();
                });
            });

            function onHandData(mid, module, data) {
                var canvas = document.getElementById('myCanvas');
                var context = canvas.getContext('2d');
                var radius = 5;
                var scale = 1;

                canvas.width = imageSize.width;
                canvas.height = imageSize.height;

                if (data.hands == undefined) return;

                for (h = 0; h < data.hands.length; h++) {
                    var hand = new Hand(data.hands[h]);
                    //console.log(data.hands[h]);
                    //console.log("isA: " + hand.isA());
                    //console.log("isB: " + hand.isB());
                    //console.log("isC: " + hand.isC());
                    //console.log("isD: " + hand.isD());
                    //console.log("isE: " + hand.isE());
                    //console.log("isF: " + hand.isF());
                    //console.log("isG: " + hand.isG());
                    //console.log("isH: " + hand.isH());
                    //console.log("isI: " + hand.isI());
                    //console.log("isJ: " + hand.isJ());
                    //console.log("isK: " + hand.isK());
                    //console.log("isL: " + hand.isL());
                    //console.log("isM: " + hand.isM());
                    //console.log("isN: " + hand.isN());
                    //console.log("isO: " + hand.isO());
                    //console.log("isP: " + hand.isP());
                    //console.log("isQ: " + hand.isQ());
                    //console.log("isS: " + hand.isS());
                    //console.log("isT: " + hand.isT());
                    //console.log("isU: " + hand.isU());
                    //console.log("isV: " + hand.isV());
                    //console.log("isW: " + hand.isW());
                    console.log("isX: " + hand.isX());
                    //console.log("isY: " + hand.isY());
                    //console.log(data.hands[h]);
                    var joints = data.hands[h].trackedJoint;
                    var baseX = joints[0].positionImage.x;
                    var baseY = joints[0].positionImage.y;
                    var wristX = joints[0].positionImage.x;
                    var wristY = joints[0].positionImage.y;

                    /*context.font="40px Georgia";
                    var fns = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q",
                        "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
                    for(f = 0; f < fns.length; f++){
                        fn = "is"+ fns[f];
                        console.log("**************** " + fn + " ****************");
                        if(hand[fn]()){
                            context.fillText(fns[f], 400, 400);
                        }
                    }*/

                    for (j = 0; j < joints.length; j++) {
                        if (joints[j] == null || joints[j].confidence <= 0) continue;

                        var x = joints[j].positionImage.x;
                        var y = joints[j].positionImage.y;
                        var z = joints[j].positionWorld.z;

                        context.font="20px Georgia";
                        context.fillText(j, x + 5, y + 5 );

                        context.beginPath();
                        context.arc(x * scale, y * scale, radius, 0, 2 * Math.PI);
                        context.lineWidth = 2;
                        context.strokeStyle = 'green';
                        context.stroke();

                        if (j == 2 || j == 6 || j == 10 || j == 14 || j == 18) {
                            baseX = wristX;
                            baseY = wristY;
                        }

                        context.beginPath();
                        context.moveTo(baseX * scale, baseY * scale);
                        context.lineTo(x * scale, y * scale);
                        context.stroke();

                        baseX = x;
                        baseY = y;
                    }
                }
                for (a = 0; a < data.alerts.length; a++) {
                    $('#alerts_status').text('Alert: ' + JSON.stringify(data.alerts[a]));
                }
                for (g = 0; g < data.gestures.length; g++) {
                    $('#gestures_status').text('Gesture: ' + JSON.stringify(data.gestures[g]));
                }
            }

            function onConnect(data) {
                if (data.connected == false) {
                    $('#alerts_status').append('Alert: ' + JSON.stringify(data) + '<br>');
                }
            }

            function onStatus(data) {
                if (data.sts < 0) {
                    status('Error ' + data.sts);
                    clear();
                }
            }

            function status(msg) {
                $('#status').text(msg);
            }

            Array.prototype.clone = function() {
                var arr = [];
                for(i = 0; i < this.length; i++){
                    arr.push(this[i]);
                }
                return arr;
            };

            function Joint(joint){
                this.x = joint.positionImage.x;
                this.y = joint.positionImage.y;
                this.z = joint.positionWorld.z;
            }

            function Finger(name, joints, foldedness){
                this.name = name;
                this.a = new Joint(joints[0]);
                this.b = new Joint(joints[1]);
                this.c = new Joint(joints[2]);
                this.tip = new Joint(joints[3]);
                this.foldedness = foldedness;
            }

            function Hand (hand){
                var copyOfJoints = hand.trackedJoint.clone();
                this.thumb = new Finger("thumb", copyOfJoints.splice(2, 4), hand.fingerData[0].foldedness);
                this.index = new Finger("index", copyOfJoints.splice(2, 4), hand.fingerData[1].foldedness);
                this.middle = new Finger("middle", copyOfJoints.splice(2, 4), hand.fingerData[2].foldedness);
                this.ring = new Finger("ring", copyOfJoints.splice(2, 4), hand.fingerData[3].foldedness);
                this.pinky = new Finger("pinky", copyOfJoints.splice(2, 4), hand.fingerData[4].foldedness);
                this.openness = hand.openness;
            }

            Finger.prototype.isPointedUp = function() {
                return this.tip.y < this.c.y && this.c.y < this.b.y && this.b.y < this.a.y;
            };

            Finger.prototype.isPointedDown = function() {
                return this.tip.y > this.c.y && this.c.y > this.b.y && this.b.y > this.a.y;
            };

            Finger.prototype.isPointedRight = function() {
                return this.tip.x < this.c.x && this.c.x < this.b.x && this.b.x < this.a.x;
            };

            Finger.prototype.isPointedLeft = function() {
                return this.tip.x > this.c.x && this.c.x > this.b.x && this.b.x > this.a.x;
            };

            Finger.prototype.isFolded = function() {
                return this.foldedness < 30;
            };

            Finger.prototype.isVertical = function() {
                var min = Math.min(Math.min(Math.min(this.tip.x, this.c.x), this.b.x), this.a.x);
                var avgDiff = ((this.tip.x - min) + (this.c.x - min) + (this.b.x - min) + (this.a.x - min))/4;
                return avgDiff < 20;
            };

            Finger.prototype.isHorizontal = function() {
                var min = Math.min(Math.min(Math.min(this.tip.y, this.c.y), this.b.y), this.a.y);
                var avgDiff = ((this.tip.y - min) + (this.c.y - min) + (this.b.y - min) + (this.a.y - min))/4;
                return avgDiff < 20;
            };

            Hand.prototype.isA = function() {
                if (this.thumb.isPointedUp() && this.thumb.isVertical()){
                    console.log("isA: thumb is pointed straight upward");
                    if (this.index.isFolded()) {
                        console.log("isA: index is folded");
                        if (this.middle.isFolded()) {
                            console.log("isA: middle is folded");
                            if (this.ring.isFolded()) {
                                console.log("isA: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isA: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isB = function() {
                if (this.index.isPointedUp() && this.index.isVertical()){
                    console.log("isB: index is pointed straight upward");
                    if (this.middle.isPointedUp() && this.middle.isVertical()){
                        console.log("isB: middle is pointed straight upward");
                        if (this.ring.isPointedUp() && this.ring.isVertical()){
                            console.log("isB: ring is pointed straight upward");
                            if (this.pinky.isPointedUp() && this.pinky.isVertical()){
                                console.log("isB: pinky is pointed straight upward");
                                if (this.thumb.isFolded()) {
                                    console.log("isB: thumb is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isC = function() {
                if (this.openness > 50 && this.openness < 80) {
                    console.log("isC: fingers are partially closed");
                    if (this.index.isPointedLeft()) {
                        console.log("isC: fingers are pointed to the left.");
                        return true;
                    }
                }
                return false;
            };

            Hand.prototype.isD = function() {
                if (this.index.isPointedUp() && this.index.isVertical()){
                    console.log("isD: index is pointed straight upward");
                    if (this.thumb.isFolded()) {
                        console.log("isD: thumb is folded");
                        if (this.middle.isFolded()) {
                            console.log("isD: middle is folded");
                            if (this.ring.isFolded()) {
                                console.log("isD: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isD: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isE = function() {
                if (this.openness < 20) {
                    console.log("isE: fingers are closed");
                    if (this.thumb.isFolded() && this.thumb.isPointedRight()) {
                        console.log("isE: thumb is bent");
                        if (this.thumb.a.y < this.index.tip.y) {
                            console.log("isE: thumb is lower than tip of index finger");
                            return true;
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isF = function() {
                if (this.pinky.isPointedUp()) {
                    console.log("isF: pinky is pointed upward");
                    if (this.ring.isPointedUp()) {
                        console.log("isF: ring is pointed upward");
                        if (this.middle.isPointedUp()) {
                            console.log("isF: middle is pointed upward");
                            if (this.thumb.isFolded()) {
                                console.log("isF: thumb is folded");
                                if (this.index.isFolded()) {
                                    console.log("isF: index is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }

                return false;
            };

            Hand.prototype.isG = function() {
                if (this.index.isPointedRight() && this.index.isHorizontal()) {
                    console.log("isG: index finger is horizontal and pointed to the right");

                    var min = Math.min(Math.min(this.thumb.tip.y, this.thumb.c.y), this.thumb.b.y);
                    var avgDiff = ((this.thumb.tip.y - min) + (this.thumb.c.y - min) + (this.thumb.b.y - min))/3;

                    if (this.thumb.isPointedRight() && avgDiff < 20) {
                        console.log("isG: thumb is horizontal and pointed to the right");
                        if (this.middle.isFolded()) {
                            console.log("isG: middle is folded");
                            if (this.ring.isFolded()) {
                                console.log("isG: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isG: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isH = function() {
                if (this.index.isPointedRight() && this.index.isHorizontal()) {
                    console.log("isH: index finger is horizontal and pointed to the right");
                    if (this.middle.isPointedRight() && this.middle.isHorizontal()) {
                        console.log("isH: middle finger is horizontal and pointed to the right");
                        if (this.thumb.isFolded()) {
                            console.log("isH: thumb is folded");
                            if (this.ring.isFolded()) {
                                console.log("isH: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isH: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isI = function() {
                if (this.pinky.isPointedUp() && this.index.isVertical()) {
                    console.log("isI: pinky is pointed straight up");
                    if (this.middle.isFolded()) {
                        console.log("isI: middle finger is folded");
                        if (this.thumb.isFolded()) {
                            console.log("isI: thumb is folded");
                            if (this.ring.isFolded()) {
                                console.log("isI: ring is folded");
                                    return true;
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isJ = function() {}

            Hand.prototype.isK = function() {
                if(this.middle.isPointedUp()){
                    console.log("isK: middle finger is pointed upward");
                    if(this.index.isPointedUp()) {
                        console.log("isK: index finger is pointed upward");
                        if (this.index.tip.x - this.middle.tip.x > 90) {
                            console.log("isK: index and middle finger form a V shape");
                            if (this.thumb.isPointedUp() && this.thumb.isVertical()) {
                                console.log("isK: thumb is pointed straight up");
                                if (this.ring.isFolded()) {
                                    console.log("isK: ring is folded");
                                    if (this.pinky.isFolded()) {
                                        console.log("isK: pinky is folded");
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isL = function() {
                if(this.index.isPointedUp() && this.index.isVertical()){
                    console.log("isL: index finger is pointed straight upward");
                    if(this.thumb.isPointedLeft() && this.thumb.isHorizontal()) {
                        console.log("isK: thumb is horizontal and pointed to the left");
                        if (this.middle.isFolded()) {
                            console.log("isK: middle is folded");
                            if (this.ring.isFolded()) {
                                console.log("isK: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isK: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isM = function() {
                if (this.pinky.isFolded()) {
                    console.log("isM: pinky is folded");
                    if (this.ring.isFolded()) {
                        console.log("isM: ring is folded");
                        if (this.middle.isFolded()) {
                            console.log("isM: middle is folded");
                            if (this.index.isFolded()) {
                                console.log("isM: index is folded");
                                //thumb is lower than ring, middle and index's b joint.
                                if(this.thumb.tip.y > this.ring.b.y
                                        && this.thumb.tip.y > this.middle.b.y
                                        && this.thumb.tip.y > this.index.b.y
                                        && this.thumb.tip.y < this.pinky.b.y) {
                                    console.log("isM: thumb is tucked");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isN = function() {
                if (this.pinky.isFolded()) {
                    console.log("isN: pinky is folded");
                    if (this.ring.isFolded()) {
                        console.log("isN: ring is folded");
                        if (this.middle.isFolded()) {
                            console.log("isN: middle is folded");
                            if (this.index.isFolded()) {
                                console.log("isN: index is folded");
                                //thumb is lower than middle and index's b joint.
                                if(this.thumb.tip.y > this.middle.b.y
                                        && this.thumb.tip.y > this.index.b.y
                                        && this.thumb.tip.y < this.ring.b.y
                                        && this.thumb.tip.y < this.pinky.b.y) {
                                    console.log("isN: thumb is tucked");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isO = function() {
                if (this.pinky.isFolded()
                        && this.ring.isFolded()
                        && this.middle.isFolded()
                        && this.index.isFolded()
                        && this.thumb.isFolded()) {
                        console.log("isO: all fingers are folded");
                    if (this.thumb.tip.y - this.middle.tip.y < 40) {
                        console.log("isO: middle finger and thumb are close");
                        return true;
                    }
                }
                return false;
            };

            Hand.prototype.isP = function() {
                if (this.index.isPointedRight() && this.index.isHorizontal()) {
                    console.log("isP: index finger is horizontal and pointed to the right");
                    if (this.middle.isVertical() && this.middle.isPointedDown()) {
                        console.log("isP: middle finger is pointed down");
                        if (this.thumb.isPointedRight()) {
                            console.log("isP: thumb is diagonal");
                            return true;
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isQ = function() {
                if (this.index.isPointedDown() && this.index.isVertical()) {
                    console.log("isQ: index finger is pointed straight down");
                    if (this.thumb.isVertical() && this.thumb.isPointedDown()) {
                        console.log("isQ: thumb is pointed straight down");
                        if (this.middle.isFolded()) {
                            console.log("isQ: middle finger is folded");
                            if (this.ring.isFolded()) {
                                console.log("isQ: ring finger is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isQ: pinky finger is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            //isR

            Hand.prototype.isS = function() {
                if (this.openness < 20) {
                    console.log("isS: fingers are closed");
                    if (this.thumb.isFolded()) {
                        console.log("isS: thumb is bent");
                        if (this.thumb.a.y > this.index.tip.y) {
                            console.log("isS: thumb is higher than tip of index finger");
                            return true;
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isT = function() {
                if (this.pinky.isFolded()) {
                    console.log("isT: pinky is folded");
                    if (this.ring.isFolded()) {
                        console.log("isT: ring is folded");
                        if (this.middle.isFolded()) {
                            console.log("isT: middle is folded");
                            if (this.index.isFolded()) {
                                console.log("isT: index is folded");
                                //thumb is lower than middle and index's b joint.
                                if(this.thumb.tip.y > this.index.b.y
                                        && this.thumb.tip.y < this.middle.b.y
                                        && this.thumb.tip.y < this.ring.b.y
                                        && this.thumb.tip.y < this.pinky.b.y) {
                                    console.log("isT: thumb is tucked between index and middle finger");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isU = function() {
                if (this.index.isPointedUp() && this.index.isVertical()){
                    console.log("isU: index is pointed straight upward");
                    if (this.middle.isPointedUp() && this.middle.isVertical()){
                        console.log("isU: middle is pointed straight upward");
                        if (this.pinky.isFolded()) {
                            console.log("isV: pinky is folded");
                            if (this.ring.isFolded()) {
                                console.log("isV: ring is folded");
                                if (this.thumb.isFolded()) {
                                    console.log("isV: thumb is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

           Hand.prototype.isV = function() {
                if(this.middle.isPointedUp()){
                    console.log("isV: middle finger is pointed upward");
                    if(this.index.isPointedUp()) {
                        console.log("isV: index finger is pointed upward");
                        if (this.index.tip.x - this.middle.tip.x > 90) {
                            console.log("isV: index and middle finger form a V shape");
                            if (this.thumb.isFolded() && !this.thumb.isVertical()) {
                                console.log("isV: thumb is folded");
                                if (this.ring.isFolded()) {
                                    console.log("isV: ring is folded");
                                    if (this.pinky.isFolded()) {
                                        console.log("isV: pinky is folded");
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isW = function() {
                if(this.middle.isPointedUp()){
                    console.log("isW: middle finger is pointed upward");
                    if(this.index.isPointedUp()) {
                        console.log("isW: index finger is pointed upward");
                        if(this.ring.isPointedUp()) {
                            console.log("isW: ring finger is pointed upward");
                            if (Math.abs(this.index.tip.x - this.middle.tip.x) > 65
                                    && Math.abs(this.middle.tip.x - this.ring.tip.x) > 65) {
                                console.log("isW: index, middle and ring finger form a W shape");
                                if (this.thumb.isFolded() && !this.thumb.isVertical()) {
                                    console.log("isW: thumb is folded");
                                    if (this.pinky.isFolded()) {
                                        console.log("isW: pinky is folded");
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isX = function() {
                console.log(this.index.isPointedUp());
                if (this.index.isPointedUp() && this.index.isFolded()){
                    console.log("isD: index is slightly folded");
                    if (this.thumb.isFolded()) {
                        console.log("isD: thumb is folded");
                        if (this.middle.isFolded()) {
                            console.log("isD: middle is folded");
                            if (this.ring.isFolded()) {
                                console.log("isD: ring is folded");
                                if (this.pinky.isFolded()) {
                                    console.log("isD: pinky is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            Hand.prototype.isY = function() {
                if(this.pinky.isPointedRight()){
                    console.log("isY: pinky finger is pointed to the right");
                    if(this.thumb.isPointedLeft()) {
                        console.log("isY: thumb is pointed to the left");
                        if (this.ring.isFolded()) {
                            console.log("isY: ring finger is folded");
                            if (this.middle.isFolded()) {
                                console.log("isY: middle is folded");
                                if (this.index.isFolded()) {
                                    console.log("isY: index is folded");
                                    return true;
                                }
                            }
                        }
                    }
                }
                return false;
            };

            //isZ


        });
    </script>
</head>

<body>
<div id="wrapper">
    <div id="container">

        <h1>Intel(R) RealSense(TM) SDK Hands Viewer Web Sample</h1>

        <div id="info"></div>
        <br>
        <input id="gestures" type="checkbox"/>Gestures
        <input id="alerts" type="checkbox"/>Alerts
        <br>
        <br>
        <button id="Start">Start</button>
        <button id="Stop" disabled="disabled">Stop</button>
        <br>
        <br>

        <canvas id="myCanvas" style="border:1px solid #000000;"></canvas>

        <div id="gestures_status"></div>
        <div id="alerts_status"></div>
        <br>
        Status:<div id="status"></div>
    </div>
</div>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            